<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMPLE BISNIS - Cyber Network (REAL-TIME)</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* -------------------------------------------------------------------
        CYBER-NETWORK THEME CSS - SEMUA CSS ASLI ANDA
        ------------------------------------------------------------------- */
        
        /* CSS Reset & Variables */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #00f0ff;
            --secondary: #ff00aa;
            --accent: #00ff88;
            --dark: #0a0a1a;
            --darker: #050510;
            --card-bg: #111128;
            --text: #ffffff;
            --text-secondary: #a0a0c0;
            --danger: #ff2a6d;
            --warning: #ffcc00;
            --success: #00ff88;
        }

        /* Loading Screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--darker);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
            overflow: hidden;
        }

        .loading-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .loading-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 240, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 0, 170, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        .loading-logo {
            font-size: 3.5rem;
            margin-bottom: 2rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 3px;
            position: relative;
            z-index: 2;
        }

        .loading-logo-text {
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
            display: inline-block;
        }

        .loading-logo-text::after {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            border-radius: 2px;
        }

        .loading-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 3rem;
            text-align: center;
            max-width: 80%;
            line-height: 1.5;
        }

        .hologram-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin-bottom: 2rem;
            perspective: 1000px;
        }

        .hologram {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(0, 240, 255, 0.8) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(255, 0, 170, 0.6) 0%, transparent 50%);
            box-shadow: 
                0 0 50px rgba(0, 240, 255, 0.5),
                inset 0 0 50px rgba(0, 240, 255, 0.2);
            animation: hologram-rotate 8s linear infinite, hologram-pulse 3s ease-in-out infinite alternate;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hologram-inner {
            width: 60%;
            height: 60%;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 240, 255, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--primary);
            font-size: 2rem;
            animation: hologram-inner 4s linear infinite;
        }

        .loading-progress-container {
            width: 300px;
            margin-top: 2rem;
        }

        .loading-progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .loading-progress {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .loading-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            transition: width 0.3s ease;
            position: relative;
        }

        .loading-bar::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
            animation: loading-shine 2s infinite;
        }

        .loading-dots {
            display: flex;
            gap: 5px;
            margin-top: 1rem;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: dot-pulse 1.5s infinite ease-in-out;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
            background: var(--secondary);
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
            background: var(--accent);
        }

        @keyframes hologram-rotate {
            0% { transform: rotateY(0deg) rotateX(0deg); }
            100% { transform: rotateY(360deg) rotateX(360deg); }
        }

        @keyframes hologram-pulse {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.05); opacity: 1; }
        }

        @keyframes hologram-inner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes loading-shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes dot-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.7; }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 240, 255, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 240, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 240, 255, 0); }
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .cyber-header {
            background: rgba(10, 10, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--primary);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo { 
            display: flex; 
            align-items: center; 
            gap: 1rem; 
            position: relative;
        }
        
        .logo-icon { 
            font-size: 1.8rem; 
            color: var(--primary); 
            animation: pulse 2s infinite;
            position: relative;
            z-index: 2;
        }
        
        .logo-icon::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, rgba(0, 240, 255, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            z-index: -1;
        }
        
        .logo-text { 
            font-size: 1.8rem; 
            font-weight: 900; 
            text-transform: uppercase;
            letter-spacing: 1px;
            background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            position: relative;
            padding-right: 10px;
        }
        
        .logo-text::after {
            content: "";
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
            border-radius: 1px;
        }

        .nav-tabs { 
            display: flex; 
            gap: 0.5rem; 
            position: relative;
        }
        
        .cyber-tab {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 240, 255, 0.3);
            color: var(--text);
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex; 
            align-items: center; 
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            font-size: 0.8rem;
        }
        
        .cyber-tab::before {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 240, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .cyber-tab:hover::before {
            left: 100%;
        }
        
        .cyber-tab:hover { 
            background: rgba(0, 240, 255, 0.1); 
            border-color: var(--primary); 
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .cyber-tab.active { 
            background: rgba(0, 240, 255, 0.2); 
            border-color: var(--primary); 
            box-shadow: 0 0 10px rgba(0, 240, 255, 0.5), inset 0 0 10px rgba(0, 240, 255, 0.1);
        }

        /* Main Layout */
        .main-container {
            max-width: 1400px;
            margin: 1rem auto;
            padding: 0 1rem;
            height: calc(100vh - 100px);
            position: relative;
        }
        
        @media (max-width: 768px) {
            .main-container { padding: 0; margin-top: 0; height: calc(100vh - 140px); }
            
            .loading-logo {
                font-size: 2.5rem;
            }
            
            .hologram-container {
                width: 150px;
                height: 150px;
            }
            
            .cyber-tab {
                padding: 0.6rem 1rem;
                font-size: 0.7rem;
            }
            
            .logo-text {
                font-size: 1.5rem;
            }
        }

        .app-section { display: none; height: 100%; opacity: 0; transition: opacity 0.3s ease; }
        .app-section.active { display: block; opacity: 1; }

        /* Inputs & Buttons */
        .cyber-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 240, 255, 0.3);
            border-radius: 5px;
            padding: 0.8rem;
            color: var(--text);
            width: 100%;
            margin-bottom: 0.8rem;
        }
        .cyber-input:focus { border-color: var(--primary); outline: none; }
        .cyber-input::placeholder { color: var(--text-secondary); opacity: 0.7; }

        .cyber-button {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 5px;
            padding: 0.8rem;
            color: white;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            text-transform: uppercase;
            transition: 0.3s;
        }
        .cyber-button:hover { transform: translateY(-2px); box-shadow: 0 0 15px rgba(0, 240, 255, 0.4); }
        .cyber-button:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; box-shadow: none; }
        
        /* MAPS SECTION */
        .maps-section {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            background: var(--card-bg);
            border: 1px solid rgba(0, 240, 255, 0.3);
            height: 100%;
        }
        #map { height: 100%; width: 100%; z-index: 1; }
        .maps-controls {
            position: absolute; top: 20px; left: 20px; z-index: 999;
            background: rgba(17, 17, 40, 0.95); backdrop-filter: blur(10px);
            padding: 1.5rem; border-radius: 10px; border: 1px solid rgba(0, 240, 255, 0.3);
            width: 350px; max-height: calc(100% - 40px); overflow-y: auto;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        @media (max-width: 768px) {
            .maps-controls { top: auto; bottom: 0; left: 0; right: 0; width: 100%; max-height: 80vh; border-radius: 20px 20px 0 0; transform: translateY(0); }
            .maps-controls.hidden-panel { transform: translateY(100%); }
        }
        .mobile-map-toggle {
            display: none; position: absolute; bottom: 20px; right: 20px; z-index: 1000;
            background: var(--primary); color: var(--darker); border: none; border-radius: 50%;
            width: 50px; height: 50px; font-size: 1.2rem; box-shadow: 0 0 15px rgba(0, 240, 255, 0.5);
            cursor: pointer; align-items: center; justify-content: center;
        }
        @media (max-width: 768px) { .mobile-map-toggle { display: flex; } }
        .marker-categories { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; margin: 1rem 0; }
        .category-btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.5rem; border-radius: 5px; color: var(--text-secondary);
            cursor: pointer; font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; gap: 0.3rem;
            transition: all 0.2s ease;
        }
        .category-btn:hover { background: rgba(0, 240, 255, 0.05); }
        .category-btn.active { border-color: var(--primary); background: rgba(0, 240, 255, 0.2); color: var(--text); box-shadow: 0 0 5px rgba(0, 240, 255, 0.3); }
        .map-search-controls { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        .map-search-box { flex: 1; position: relative; }
        .map-search-box i { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }
        .map-search-box input { padding-left: 35px; }
        .map-filter-btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary); padding: 0.5rem 1rem; border-radius: 5px; cursor: pointer;
            font-size: 0.8rem; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.3rem;
        }
        .map-filter-btn.active { background: rgba(0, 240, 255, 0.2); border-color: var(--primary); color: var(--text); }
        .marker-list-container { margin-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1rem; }
        .marker-list { max-height: 300px; overflow-y: auto; margin-top: 0.5rem; }
        .marker-item {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 5px; padding: 0.8rem; margin-bottom: 0.5rem; cursor: pointer; transition: all 0.3s ease;
        }
        .marker-item:hover { border-color: var(--primary); background: rgba(0, 240, 255, 0.1); }
        .marker-item h4 { color: var(--primary); margin-bottom: 0.3rem; font-size: 0.9rem; }
        .marker-item p { color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 0.3rem; }
        .marker-item .marker-category {
            display: inline-block; background: rgba(0, 240, 255, 0.2); color: var(--primary);
            padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.7rem;
        }

        /* QUEST BOARD */
        .quest-section {
            background: var(--card-bg); border-radius: 15px;
            border: 1px solid rgba(0, 240, 255, 0.3); height: 100%;
            display: flex; flex-direction: column; position: relative;
        }
        .quest-header { padding: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .quest-list { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
        .quest-item {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px; padding: 1.5rem; cursor: pointer; transition: 0.3s; position: relative;
        }
        .quest-item:hover { transform: translateY(-3px); border-color: var(--primary); }
        .quest-item h4 { color: var(--primary); margin-bottom: 0.5rem; }
        .quest-status { float: right; font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; }
        .status-open { background: var(--success); color: black; }
        .status-taken { background: var(--warning); color: black; }
        .quest-controls { display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .search-box { flex: 1; min-width: 200px; position: relative; }
        .search-box i { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }
        .search-box input { padding-left: 35px; }
        .category-filter { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .filter-btn {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary); padding: 0.5rem 1rem; border-radius: 20px; cursor: pointer;
            font-size: 0.8rem; transition: all 0.3s ease;
        }
        .filter-btn.active { background: rgba(0, 240, 255, 0.2); border-color: var(--primary); color: var(--text); }
        .fab-add-quest {
            position: absolute; bottom: 2rem; right: 2rem; width: 60px; height: 60px;
            background: var(--primary); color: var(--darker); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem;
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.5); border: none; cursor: pointer; z-index: 10;
            transition: 0.3s;
        }
        .fab-add-quest:hover { transform: scale(1.1); }

        /* TOOLS SECTION (WHOIS) */
        .tools-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; padding: 2rem; }
        @media (max-width: 768px) { .tools-grid { padding: 1rem; } }
        .tool-card {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px; padding: 1.5rem;
        }
        .tool-result {
            margin-top: 1rem; padding: 1rem;
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); border-radius: 5px;
            display: none; font-family: 'Consolas', monospace; font-size: 0.85rem;
            white-space: pre-wrap; color: #d0d0d0; line-height: 1.5;
        }
        
        /* AI CHAT SECTION */
        .ai-chat-section {
            background: var(--card-bg); border-radius: 15px;
            border: 1px solid rgba(0, 240, 255, 0.3); height: 100%;
            display: flex; flex-direction: column; position: relative;
        }
        .chat-header { padding: 1rem 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .chat-body { flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
        .chat-input-area { 
            padding: 1rem 1.5rem; 
            border-top: 1px solid rgba(255,255,255,0.1); 
            display: flex; 
            flex-direction: column;
            gap: 0.5rem;
        }

        .message {
            max-width: 80%;
            padding: 0.7rem 1rem;
            border-radius: 15px;
            font-size: 0.9rem;
            word-wrap: break-word;
        }
        .user-message {
            background: var(--primary);
            color: var(--darker);
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .ai-message {
            background: var(--dark);
            color: var(--text);
            border: 1px solid rgba(0, 240, 255, 0.3);
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }
        .message-model-tag {
            font-size: 0.7rem;
            color: var(--accent);
            margin-top: 5px;
            display: block;
        }
        .chat-controls { display: flex; gap: 0.5rem; align-items: flex-start; }
        .chat-input-wrapper { flex-grow: 1; position: relative; }
        .chat-input-wrapper textarea {
            min-height: 50px;
            resize: none;
            padding-right: 40px; 
            padding-top: 15px;
        }
        .chat-input-wrapper .send-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.3s;
        }
        .chat-input-wrapper .send-btn:hover { color: var(--secondary); }
        .chat-input-wrapper .send-btn:disabled { color: #444; cursor: not-allowed; }

        .model-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .model-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 8px 16px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .model-btn.active {
            background: rgba(0, 240, 255, 0.2);
            border-color: var(--primary);
            color: var(--text);
        }

        /* MODALS */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            z-index: 2000; justify-content: center; align-items: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--card-bg); border: 1px solid var(--primary);
            padding: 2rem; border-radius: 15px; width: 90%; max-width: 500px;
            max-height: 90vh; overflow-y: auto;
            position: relative;
        }
        .close-modal {
            position: absolute; top: 1rem; right: 1rem;
            background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;
            transition: 0.3s;
        }
        .close-modal:hover { color: var(--danger); transform: rotate(90deg); }

        /* Admin Section */
        .admin-section {
            display: none;
            padding: 2rem;
            background: var(--card-bg);
            border-radius: 15px;
            border: 1px solid rgba(0, 240, 255, 0.3);
            margin: 1rem;
        }
        .admin-section.active { display: block; }

        /* Admin Dashboard Styles */
        .admin-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .admin-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 240, 255, 0.3);
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .admin-card:hover {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
        }

        .admin-card h3 {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .admin-list {
            max-height: 400px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 1rem;
        }

        .admin-list-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-list-item:hover {
            border-color: var(--primary);
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.3rem 0.8rem;
            font-size: 0.7rem;
            width: auto;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-warning {
            background: var(--warning);
            color: black;
        }

        .btn-success {
            background: var(--success);
            color: black;
        }

        .category-badge {
            background: rgba(0, 240, 255, 0.2);
            color: var(--primary);
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
        }

        .visitor-info {
            font-family: 'Consolas', monospace;
            font-size: 0.8rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .header-content { flex-direction: column; gap: 1rem; }
            .nav-tabs { width: 100%; justify-content: center; }
            .cyber-tab { font-size: 0.8rem; padding: 0.6rem; }
            .quest-controls { flex-direction: column; }
            .map-search-controls { flex-direction: column; }
            .chat-input-area { padding: 0.5rem; }
            .model-selector { flex-direction: column; }
            .admin-dashboard { grid-template-columns: 1fr; }
            .admin-controls { grid-template-columns: 1fr; }
        }

        /* Real-time UI Elements */
        .connection-status {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,240,255,0.3);
        }
        
        .connection-status.connected {
            color: #00ff88;
        }
        
        .connection-status.disconnected {
            color: #ff2a6d;
            animation: pulse 1.5s infinite;
        }
        
        .connection-status.reconnecting {
            color: #ffcc00;
            animation: pulse 1s infinite;
        }
        
        .realtime-notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--primary);
            color: var(--darker);
            padding: 12px 16px;
            border-radius: 8px;
            z-index: 9999;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s;
            max-width: 300px;
            box-shadow: 0 5px 15px rgba(0, 240, 255, 0.4);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(0,240,255,0.5);
        }
        
        .realtime-notification.success {
            background: var(--success);
            color: black;
        }
        
        .realtime-notification.error {
            background: var(--danger);
            color: white;
        }
        
        .realtime-notification.warning {
            background: var(--warning);
            color: black;
        }
        
        .realtime-notification.info {
            background: var(--primary);
            color: var(--darker);
        }
        
        .user-count {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0,240,255,0.3);
            color: var(--primary);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="loading-container">
            <div class="loading-background"></div>
            <div class="loading-logo">
                <span class="loading-logo-text">SIMPLE BISNIS</span>
            </div>
            <div class="loading-subtitle">
                Cyber Network Platform - REAL-TIME EDITION
            </div>
            <div class="hologram-container">
                <div class="hologram">
                    <div class="hologram-inner">
                        <i class="fas fa-satellite-dish"></i>
                    </div>
                </div>
            </div>
            <div class="loading-progress-container">
                <div class="loading-progress-text">
                    <span>CONNECTING TO SERVER</span>
                    <span id="loading-percentage">0%</span>
                </div>
                <div class="loading-progress">
                    <div class="loading-bar" id="loading-bar"></div>
                </div>
            </div>
            <div class="loading-dots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>

    <header class="cyber-header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-satellite-dish logo-icon"></i>
                <div class="logo-text">SIMPLE BISNIS</div>
            </div>
            <div class="nav-tabs">
                <button class="cyber-tab active" onclick="switchTab('maps')">
                    <i class="fas fa-map-marked-alt"></i> MAPS
                </button>
                <button class="cyber-tab" onclick="switchTab('quests')">
                    <i class="fas fa-scroll"></i> QUEST BOARD
                </button>
                <button class="cyber-tab" onclick="switchTab('tools')">
                    <i class="fas fa-tools"></i> TOOLS
                </button>
                <button class="cyber-tab" onclick="switchTab('chat')">
                    <i class="fas fa-robot"></i> CHAT AI
                </button>
            </div>
        </div>
    </header>

    <div class="main-container">
        
        <div id="maps" class="app-section active">
            <div class="maps-section">
                <button class="mobile-map-toggle" onclick="toggleMapPanel()">
                    <i class="fas fa-layer-group"></i>
                </button>

                <div class="maps-controls" id="mapPanel">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                        <h3 style="color: var(--primary);"><i class="fas fa-map-pin"></i> KONTROL MAP</h3>
                        <button onclick="toggleMapPanel()" style="background:none; border:none; color:white; cursor:pointer;" title="Minimize">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>

                    <div style="background: rgba(0,240,255,0.1); padding: 0.5rem; border-radius: 5px; margin-bottom: 1rem; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Klik pada peta untuk memilih lokasi marker.
                    </div>

                    <div class="map-search-controls">
                        <div class="map-search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="mapSearch" class="cyber-input" placeholder="Cari lokasi...">
                        </div>
                        <button class="map-filter-btn" onclick="toggleMapFilter()">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>

                    <div id="mapFilterOptions" style="display: none; margin-bottom: 1rem;">
                        <div style="color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 0.5rem;">Filter Kategori:</div>
                        <div class="category-filter">
                            <button class="filter-btn active" onclick="filterMapMarkers(event, 'all')">Semua</button>
                            <button class="filter-btn" onclick="filterMapMarkers(event, 'traffic')">Macet</button>
                            <button class="filter-btn" onclick="filterMapMarkers(event, 'accident')">Kecelakaan</button>
                            <button class="filter-btn" onclick="filterMapMarkers(event, 'shop')">Toko</button>
                            <button class="filter-btn" onclick="filterMapMarkers(event, 'service')">Jasa</button>
                            <button class="filter-btn" onclick="filterMapMarkers(event, 'event')">Event</button>
                        </div>
                    </div>

                    <input type="text" id="markerTitle" class="cyber-input" placeholder="Judul (Cth: Macet Total)">
                    <textarea id="markerDesc" class="cyber-input" rows="2" placeholder="Deskripsi Singkat..."></textarea>

                    <label style="color: var(--text-secondary); font-size: 0.8rem;">Kategori Marker:</label>
                    <div class="marker-categories" id="categoryGrid">
                        <div class="category-btn active" onclick="selectCategory(this, 'traffic')">
                            <i class="fas fa-traffic-light"></i> Macet
                        </div>
                        <div class="category-btn" onclick="selectCategory(this, 'accident')">
                            <i class="fas fa-car-crash"></i> Kecelakaan
                        </div>
                        <div class="category-btn" onclick="selectCategory(this, 'shop')">
                            <i class="fas fa-store"></i> Toko
                        </div>
                        <div class="category-btn" onclick="selectCategory(this, 'service')">
                            <i class="fas fa-tools"></i> Jasa
                        </div>
                        <div class="category-btn" onclick="selectCategory(this, 'event')">
                            <i class="fas fa-calendar"></i> Event
                        </div>
                        <div class="category-btn" onclick="selectCategory(this, 'other')">
                            <i class="fas fa-map-marker-alt"></i> Lainnya
                        </div>
                    </div>

                    <label style="color: var(--text-secondary); font-size: 0.8rem;">Buat Kategori Custom:</label>
                    <div class="custom-maker-group">
                        <input type="text" id="customCatName" class="cyber-input" style="margin-bottom:0;" placeholder="Nama Kategori Baru...">
                        <button class="cyber-button" onclick="saveCustomCategory()" style="margin-top: 0.5rem;">
                            SIMPAN KATEGORI
                        </button>
                    </div>
                    <div id="customCatList" style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;"></div>

                    <div style="margin-top: 1.5rem;">
                        <button class="cyber-button" onclick="addMarker()" id="btnAddMarker" disabled>
                            <i class="fas fa-plus-circle"></i> TAMBAH MARKER
                        </button>
                    </div>

                    <div class="marker-list-container">
                        <h4 style="color: var(--primary); margin-bottom: 0.5rem;">
                            <i class="fas fa-list"></i> DAFTAR MARKER
                        </h4>
                        <div class="marker-list" id="markerList">
                            <!-- Marker list akan diisi real-time -->
                        </div>
                    </div>
                </div>
                <div id="map"></div>
            </div>
        </div>

        <div id="quests" class="app-section">
            <div class="quest-section">
                <div class="quest-header">
                    <h2 style="color: var(--primary);"><i class="fas fa-scroll"></i> PAPAN QUEST</h2>
                    <p style="color: var(--text-secondary);">Ambil pekerjaan atau tawarkan jasa di sini.</p>
                    
                    <div class="quest-controls">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="questSearch" class="cyber-input" placeholder="Cari quest...">
                        </div>
                        <div class="category-filter">
                            <button class="filter-btn active" onclick="filterQuests(event, 'all')">Semua</button>
                            <button class="filter-btn" onclick="filterQuests(event, 'design')">Desain</button>
                            <button class="filter-btn" onclick="filterQuests(event, 'programming')">Programming</button>
                            <button class="filter-btn" onclick="filterQuests(event, 'marketing')">Marketing</button>
                            <button class="filter-btn" onclick="filterQuests(event, 'writing')">Writing</button>
                            <button class="filter-btn" onclick="filterQuests(event, 'other')">Lainnya</button>
                        </div>
                    </div>
                </div>
                
                <div class="quest-list" id="questListContainer">
                    <!-- Quest list akan diisi real-time -->
                </div>

                <button class="fab-add-quest" onclick="openModal('modalPostQuest')">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>

        <div id="tools" class="app-section">
            <h2 style="color: var(--primary); margin-bottom: 1rem; padding: 0 1rem;"><i class="fas fa-terminal"></i> CYBER TOOLS</h2>
            <div class="tools-grid">
                
                <div class="tool-card">
                    <h3 style="color: var(--warning);"><i class="fas fa-globe"></i> WHOIS & DOMAIN INFO</h3>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 1rem;">
                        Cek status domain terdaftar atau tidak (Menggunakan Google DNS over HTTPS).
                    </p>
                    <input type="text" id="domainInput" class="cyber-input" placeholder="contoh: google.com">
                    <button class="cyber-button" onclick="checkWhois()">CEK DOMAIN</button>
                    <div id="whoisResult" class="tool-result"></div>
                </div>

            </div>
        </div>
        
        <div id="chat" class="app-section">
            <div class="ai-chat-section">
                <div class="chat-header">
                    <h2 style="color: var(--primary);"><i class="fas fa-robot"></i> CHAT AI</h2>
                    <p style="color: var(--text-secondary); font-size: 0.8rem;">DeX 75 AI & Pollination AI Powered</p>
                    
                    <div class="model-selector">
                        <button class="model-btn active" onclick="selectModel('dex75')">
                            <i class="fas fa-brain"></i> DeX 75 AI
                        </button>
                        <button class="model-btn" onclick="selectModel('pollination')">
                            <i class="fas fa-robot"></i> Pollination AI
                        </button>
                    </div>
                </div>
                
                <div class="chat-body" id="chatBody">
                    <div class="ai-message message">
                        Halo! Saya adalah AI asisten yang siap membantu Anda. Silakan pilih model AI dan mulai chat.
                        <span class="message-model-tag">System</span>
                    </div>
                </div>

                <div class="chat-input-area">
                    <div class="chat-controls">
                        <div class="chat-input-wrapper">
                            <textarea id="chatInput" class="cyber-input" rows="1" placeholder="Tulis pesan..." style="margin-bottom: 0;"></textarea>
                            <button class="send-btn" onclick="sendMessage()" id="chatSendButton">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="admin" class="admin-section">
            <h2 style="color: var(--primary); margin-bottom: 1rem;"><i class="fas fa-user-shield"></i> ADMIN PANEL</h2>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Panel ini hanya dapat diakses melalui URL /admin</p>
            
            <!-- Admin Dashboard -->
            <div class="admin-dashboard">
                <div class="admin-card">
                    <h3><i class="fas fa-chart-bar"></i> STATISTIK</h3>
                    <div class="stat-number" id="totalQuests">0</div>
                    <div class="stat-label">Total Quests</div>
                    <div class="stat-number" id="totalMarkers">0</div>
                    <div class="stat-label">Total Markers</div>
                    <div class="stat-number" id="activeUsers">0</div>
                    <div class="stat-label">Pengguna Aktif</div>
                </div>

                <div class="admin-card">
                    <h3><i class="fas fa-tachometer-alt"></i> PERFORMANCE</h3>
                    <div class="stat-number" id="questsOpen">0</div>
                    <div class="stat-label">Quests Open</div>
                    <div class="stat-number" id="questsTaken">0</div>
                    <div class="stat-label">Quests Taken</div>
                    <div class="stat-number" id="markersToday">0</div>
                    <div class="stat-label">Markers Hari Ini</div>
                </div>

                <div class="admin-card">
                    <h3><i class="fas fa-network-wired"></i> VISITOR INFO</h3>
                    <div class="visitor-info">
                        <div>IP: <span id="visitorIp">Loading...</span></div>
                        <div>Browser: <span id="visitorBrowser">Loading...</span></div>
                        <div>Platform: <span id="visitorPlatform">Loading...</span></div>
                        <div>Screen: <span id="visitorScreen">Loading...</span></div>
                    </div>
                </div>
            </div>

            <!-- Admin Controls -->
            <div class="admin-controls">
                <div class="admin-card">
                    <h3><i class="fas fa-map-marker-alt"></i> KELOLA MARKERS</h3>
                    <div class="admin-list" id="adminMarkerList">
                        <!-- Marker list akan diisi real-time -->
                    </div>
                    <button class="cyber-button btn-danger" onclick="clearAllMarkers()" style="margin-top: 1rem;">
                        <i class="fas fa-trash"></i> HAPUS SEMUA MARKERS
                    </button>
                </div>

                <div class="admin-card">
                    <h3><i class="fas fa-scroll"></i> KELOLA QUESTS</h3>
                    <div class="admin-list" id="adminQuestList">
                        <!-- Quest list akan diisi real-time -->
                    </div>
                    <button class="cyber-button btn-danger" onclick="clearAllQuests()" style="margin-top: 1rem;">
                        <i class="fas fa-trash"></i> HAPUS SEMUA QUESTS
                    </button>
                </div>

                <div class="admin-card">
                    <h3><i class="fas fa-tags"></i> KELOLA KATEGORI</h3>
                    <input type="text" id="newCategoryName" class="cyber-input" placeholder="Nama Kategori Baru">
                    <button class="cyber-button" onclick="addNewCategory()">
                        <i class="fas fa-plus"></i> TAMBAH KATEGORI
                    </button>
                    <div class="admin-list" id="adminCategoryList" style="margin-top: 1rem;">
                        <!-- Category list akan diisi real-time -->
                    </div>
                </div>
            </div>

            <!-- Data Management -->
            <div class="tools-grid">
                <div class="tool-card">
                    <h3 style="color: var(--accent);"><i class="fas fa-database"></i> DATA MANAGEMENT</h3>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 1rem;">
                        Kelola data quests, users, dan markers.
                    </p>
                    <button class="cyber-button" onclick="exportData()">
                        <i class="fas fa-download"></i> EXPORT DATA
                    </button>
                    <button class="cyber-button" style="background: var(--warning); color: black; margin-top: 0.5rem;" onclick="importData()">
                        <i class="fas fa-upload"></i> IMPORT DATA
                    </button>
                    <button class="cyber-button" style="background: var(--danger); margin-top: 0.5rem;" onclick="clearAllData()">
                        <i class="fas fa-trash"></i> CLEAR ALL DATA
                    </button>
                </div>

                <div class="tool-card">
                    <h3 style="color: var(--warning);"><i class="fas fa-chart-bar"></i> ANALYTICS</h3>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 1rem;">
                        Lihat statistik penggunaan aplikasi.
                    </p>
                    <button class="cyber-button" onclick="showAnalytics()">
                        <i class="fas fa-chart-pie"></i> VIEW ANALYTICS
                    </button>
                    <button class="cyber-button" style="margin-top: 0.5rem;" onclick="generateReport()">
                        <i class="fas fa-file-alt"></i> GENERATE REPORT
                    </button>
                </div>

                <div class="tool-card">
                    <h3 style="color: var(--success);"><i class="fas fa-cogs"></i> SYSTEM TOOLS</h3>
                    <p style="font-size: 0.8rem; color: #888; margin-bottom: 1rem;">
                        Tools untuk maintenance sistem.
                    </p>
                    <button class="cyber-button" onclick="clearCache()">
                        <i class="fas fa-broom"></i> CLEAR CACHE
                    </button>
                    <button class="cyber-button" style="margin-top: 0.5rem;" onclick="rebuildIndex()">
                        <i class="fas fa-sync"></i> REBUILD INDEX
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="modalPostQuest" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modalPostQuest')">&times;</button>
            <h3 style="color: var(--primary); margin-bottom: 1rem;">BUAT QUEST BARU</h3>
            
            <input type="text" id="qUser" class="cyber-input" placeholder="Nama Anda / Username">
            <input type="text" id="qTitle" class="cyber-input" placeholder="Judul Quest (Cth: Butuh Desain Logo)">
            <textarea id="qDesc" class="cyber-input" rows="4" placeholder="Detail pekerjaan..."></textarea>
            <input type="text" id="qContact" class="cyber-input" placeholder="Nomor WA (628xxx) / Telegram">
            
            <label style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 1rem;">Kategori Quest:</label>
            <select id="qCategory" class="cyber-input">
                <option value="design">Desain</option>
                <option value="programming">Programming</option>
                <option value="marketing">Marketing</option>
                <option value="writing">Writing</option>
                <option value="other">Lainnya</option>
            </select>
            
            <button class="cyber-button" onclick="submitQuest()">POSTING QUEST</button>
        </div>
    </div>

    <div id="modalQuestDetail" class="modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal('modalQuestDetail')">&times;</button>
            <h3 id="dTitle" style="color: var(--primary); margin-bottom: 0.5rem;">Judul Quest</h3>
            <div style="font-size: 0.8rem; color: var(--accent); margin-bottom: 1rem;">
                Posted by: <span id="dUser">User</span> | 
                Kategori: <span id="dCategory">-</span>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 5px; margin-bottom: 1.5rem;">
                <p id="dDesc">Deskripsi...</p>
            </div>

            <div style="display: grid; gap: 1rem;">
                <button class="cyber-button" style="background: var(--success); color: #000;" id="btnWA">
                    <i class="fab fa-whatsapp"></i> HUBUNGI WA
                </button>
                <button class="cyber-button" onclick="takeOrder()" id="btnTake">
                    <i class="fas fa-check-circle"></i> AMBIL ORDER
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        // ==================== REAL-TIME MANAGER ====================
        class RealtimeManager {
            constructor() {
                this.socket = null;
                this.reconnectAttempts = 0;
                this.maxReconnectAttempts = 10;
                this.reconnectDelay = 1000;
                this.isConnected = false;
                this.connectionId = null;
                
                // Data storage
                this.quests = [];
                this.markers = [];
                this.customCategories = ['design', 'programming', 'marketing', 'writing', 'other'];
                this.connectedUsers = 0;
                this.isAdmin = false;
                
                this.init();
            }
            
            init() {
                this.createConnectionUI();
                this.connect();
                this.setupEventListeners();
            }
            
            createConnectionUI() {
                // Connection status
                const statusDiv = document.createElement('div');
                statusDiv.id = 'connectionStatus';
                statusDiv.className = 'connection-status disconnected';
                statusDiv.innerHTML = `
                    <i class="fas fa-plug"></i>
                    <span>Connecting...</span>
                `;
                document.body.appendChild(statusDiv);
                
                // User count
                const userCountDiv = document.createElement('div');
                userCountDiv.id = 'userCount';
                userCountDiv.className = 'user-count';
                userCountDiv.innerHTML = `
                    <i class="fas fa-users"></i>
                    <span>0 online</span>
                `;
                document.body.appendChild(userCountDiv);
            }
            
            connect() {
                console.log(' Connecting to server...');
                this.updateStatus('Connecting...', 'reconnecting');
                
                this.socket = io({
                    reconnection: true,
                    reconnectionAttempts: this.maxReconnectAttempts,
                    reconnectionDelay: this.reconnectDelay,
                    reconnectionDelayMax: 5000,
                    timeout: 20000
                });
                
                this.setupSocketEvents();
            }
            
            setupSocketEvents() {
                // Connection events
                this.socket.on('connect', () => {
                    console.log(' Connected to server with ID:', this.socket.id);
                    this.isConnected = true;
                    this.connectionId = this.socket.id;
                    this.reconnectAttempts = 0;
                    this.updateStatus('Connected', 'connected');
                    this.showNotification('Connected to server', 'success');
                    
                    // Request initial data
                    this.socket.emit('getInitialData');
                });
                
                this.socket.on('disconnect', (reason) => {
                    console.log(' Disconnected:', reason);
                    this.isConnected = false;
                    this.updateStatus('Disconnected', 'disconnected');
                    
                    if (reason === 'io server disconnect') {
                        // Server initiated disconnect, need to manually reconnect
                        this.showNotification('Disconnected from server', 'error');
                        setTimeout(() => this.connect(), 1000);
                    }
                });
                
                this.socket.on('connect_error', (error) => {
                    console.error(' Connection error:', error.message);
                    this.updateStatus('Connection error', 'disconnected');
                    this.reconnectAttempts++;
                    
                    if (this.reconnectAttempts >= this.maxReconnectAttempts) {
                        this.showNotification('Cannot connect to server. Please refresh page.', 'error');
                    }
                });
                
                // Initial data
                this.socket.on('initialData', (data) => {
                    console.log(' Received initial data:', data);
                    this.quests = data.quests || [];
                    this.markers = data.markers || [];
                    this.customCategories = data.customCategories || this.customCategories;
                    this.isAdmin = data.isAdmin || false;
                    
                    // Update UI
                    renderQuests();
                    renderMarkerList();
                    addMarkersToMap();
                    
                    if (this.isAdmin) {
                        loadAdminDashboard();
                    }
                    
                    this.showNotification('Data synchronized', 'success');
                });
                
                // Quest events
                this.socket.on('questAdded', (newQuest) => {
                    console.log(' Quest added:', newQuest);
                    this.quests.unshift(newQuest);
                    renderQuests();
                    this.showNotification(`New quest: ${newQuest.title}`, 'info');
                });
                
                this.socket.on('questUpdated', (updatedQuest) => {
                    console.log(' Quest updated:', updatedQuest);
                    const index = this.quests.findIndex(q => q.id === updatedQuest.id);
                    if (index !== -1) {
                        this.quests[index] = updatedQuest;
                        renderQuests();
                    }
                });
                
                this.socket.on('questDeleted', (questId) => {
                    console.log(' Quest deleted:', questId);
                    this.quests = this.quests.filter(q => q.id !== questId);
                    renderQuests();
                    this.showNotification('Quest deleted', 'warning');
                });
                
                this.socket.on('allQuestsCleared', () => {
                    console.log(' All quests cleared');
                    this.quests = [];
                    renderQuests();
                    this.showNotification('All quests cleared by admin', 'warning');
                });
                
                // Marker events
                this.socket.on('markerAdded', (newMarker) => {
                    console.log(' Marker added:', newMarker);
                    this.markers.unshift(newMarker);
                    addMarkerToMap(newMarker);
                    renderMarkerList();
                    this.showNotification(`New marker: ${newMarker.title}`, 'info');
                });
                
                this.socket.on('markerDeleted', (markerId) => {
                    console.log(' Marker deleted:', markerId);
                    this.markers = this.markers.filter(m => m.id !== markerId);
                    removeMarkerFromMap(markerId);
                    renderMarkerList();
                    this.showNotification('Marker deleted', 'warning');
                });
                
                this.socket.on('allMarkersCleared', () => {
                    console.log(' All markers cleared');
                    this.markers = [];
                    markerLayerGroup.clearLayers();
                    renderMarkerList();
                    this.showNotification('All markers cleared by admin', 'warning');
                });
                
                // Category events
                this.socket.on('categoryAdded', (categoryName) => {
                    console.log(' Category added:', categoryName);
                    if (!this.customCategories.includes(categoryName)) {
                        this.customCategories.push(categoryName);
                    }
                    this.showNotification(`New category: ${categoryName}`, 'info');
                });
                
                this.socket.on('categoryDeleted', (categoryName) => {
                    console.log(' Category deleted:', categoryName);
                    const index = this.customCategories.indexOf(categoryName);
                    if (index !== -1) {
                        this.customCategories.splice(index, 1);
                    }
                    this.showNotification(`Category deleted: ${categoryName}`, 'warning');
                });
                
                // User count
                this.socket.on('userCount', (count) => {
                    console.log(' Users online:', count);
                    this.connectedUsers = count;
                    this.updateUserCount(count);
                });
                
                // Admin stats
                this.socket.on('adminStats', (stats) => {
                    console.log(' Admin stats:', stats);
                    updateAdminStats(stats);
                });
                
                // Admin notifications
                this.socket.on('adminNotification', (notification) => {
                    console.log(' Admin notification:', notification);
                    if (this.isAdmin) {
                        this.showNotification(notification.message, 'info');
                    }
                });
                
                // Ping/pong for connection health
                this.socket.on('pong', (data) => {
                    console.log(' Pong received:', data.timestamp);
                });
                
                // Send ping every 30 seconds
                setInterval(() => {
                    if (this.isConnected) {
                        this.socket.emit('ping');
                    }
                }, 30000);
            }
            
            updateStatus(message, status) {
                const statusEl = document.getElementById('connectionStatus');
                if (statusEl) {
                    statusEl.className = `connection-status ${status}`;
                    statusEl.innerHTML = `
                        <i class="fas fa-${status === 'connected' ? 'wifi' : 'plug-circle-exclamation'}"></i>
                        <span>${message}</span>
                    `;
                }
            }
            
            updateUserCount(count) {
                const countEl = document.getElementById('userCount');
                if (countEl) {
                    countEl.innerHTML = `
                        <i class="fas fa-users"></i>
                        <span>${count} online</span>
                    `;
                }
            }
            
            showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `realtime-notification ${type}`;
                
                let icon = 'fas fa-info-circle';
                if (type === 'success') icon = 'fas fa-check-circle';
                if (type === 'error') icon = 'fas fa-exclamation-circle';
                if (type === 'warning') icon = 'fas fa-exclamation-triangle';
                if (type === 'info') icon = 'fas fa-bell';
                
                notification.innerHTML = `
                    <i class="${icon}"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 3000);
            }
            
            emit(event, data) {
                if (this.isConnected && this.socket) {
                    this.socket.emit(event, data);
                } else {
                    this.showNotification('Not connected to server', 'error');
                }
            }
            
            setupEventListeners() {
                // Auto-reconnect on visibility change
                document.addEventListener('visibilitychange', () => {
                    if (document.visibilityState === 'visible' && !this.isConnected) {
                        this.connect();
                    }
                });
                
                // Try reconnect on click if disconnected
                document.addEventListener('click', () => {
                    if (!this.isConnected && this.reconnectAttempts < this.maxReconnectAttempts) {
                        this.connect();
                    }
                });
            }
            
            // Public methods for data access
            getQuests() { return this.quests; }
            getMarkers() { return this.markers; }
            getCategories() { return this.customCategories; }
            getIsAdmin() { return this.isAdmin; }
            getIsConnected() { return this.isConnected; }
        }
        
        // ==================== GLOBAL VARIABLES ====================
        const realtime = new RealtimeManager();
        let map, currentMarker = null;
        let selectedCategory = 'traffic';
        let currentQuestId = null;
        let currentQuestFilter = 'all';
        let currentQuestSearch = '';
        let markerLayerGroup = L.layerGroup();
        let currentMapFilter = 'all';
        let selectedModel = 'dex75';
        let mapMarkers = {};
        
        // ==================== LOADING SCREEN ====================
        function simulateLoading() {
            const loadingBar = document.getElementById('loading-bar');
            const loadingPercentage = document.getElementById('loading-percentage');
            const loadingScreen = document.getElementById('loading-screen');
            let progress = 0;
            
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                loadingBar.style.width = `${progress}%`;
                loadingPercentage.textContent = `${Math.floor(progress)}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                        }, 500);
                    }, 500);
                }
            }, 200);
        }
        
        // ==================== ADMIN ACCESS CONTROL ====================
        function checkAdminAccess() {
            const isAdminPath = window.location.pathname.includes('/admin');
            const urlParams = new URLSearchParams(window.location.search);
            const isAdminParam = urlParams.get('admin') === 'true';
            const isAdminHash = window.location.hash === '#admin';
            
            if (isAdminPath || isAdminParam || isAdminHash) {
                document.querySelectorAll('.app-section').forEach(el => {
                    if (el.id !== 'admin') {
                        el.style.display = 'none';
                    } else {
                        el.style.display = 'block';
                        el.classList.add('active');
                    }
                });
                
                const navTabs = document.querySelector('.nav-tabs');
                navTabs.innerHTML = '';
                
                const adminTab = document.createElement('button');
                adminTab.className = 'cyber-tab active';
                adminTab.innerHTML = '<i class="fas fa-user-shield"></i> ADMIN';
                adminTab.onclick = () => switchTab('admin');
                navTabs.appendChild(adminTab);
                
                document.title = 'SIMPLE BISNIS - Admin Panel';
                
                loadAdminDashboard();
            }
        }
        
        // ==================== TAB SWITCHING ====================
        function switchTab(tabId) {
            if (tabId === 'admin') {
                document.querySelectorAll('.app-section').forEach(el => {
                    if (el.id !== 'admin') {
                        el.style.display = 'none';
                    } else {
                        el.style.display = 'block';
                        el.classList.add('active');
                    }
                });
                
                document.querySelectorAll('.cyber-tab').forEach(el => el.classList.remove('active'));
                document.querySelector('.cyber-tab').classList.add('active');
                return;
            }
            
            document.querySelectorAll('.app-section').forEach(el => {
                el.style.display = 'block';
                el.classList.remove('active');
            });
            document.querySelectorAll('.cyber-tab').forEach(el => el.classList.remove('active'));
            
            document.getElementById(tabId).classList.add('active');
            
            const tabs = document.querySelectorAll('.cyber-tab');
            tabs.forEach(tab => {
                const tabText = tab.textContent.trim().split(' ').pop().toLowerCase();
                if (tabText === tabId || (tabId === 'chat' && tabText === 'ai')) {
                    tab.classList.add('active');
                }
            });
            
            if(tabId === 'maps' && map) {
                setTimeout(() => map.invalidateSize(), 100);
            }
        }
        
        // ==================== MODEL SELECTION ====================
        function selectModel(model) {
            selectedModel = model;
            document.querySelectorAll('.model-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        // ==================== MAP FUNCTIONS ====================
        function initMap() {
            map = L.map('map').setView([-6.200000, 106.816666], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap'
            }).addTo(map);
            markerLayerGroup.addTo(map);
            
            map.on('click', function(e) {
                if(currentMarker) map.removeLayer(currentMarker);
                currentMarker = L.marker(e.latlng).addTo(map);
                document.getElementById('btnAddMarker').disabled = false;
                
                const panel = document.getElementById('mapPanel');
                if(window.innerWidth <= 768 && panel.classList.contains('hidden-panel')) {
                    toggleMapPanel();
                }
            });
        }
        
        function addMarkersToMap() {
            const markers = realtime.getMarkers();
            markers.forEach(markerData => {
                addMarkerToMap(markerData);
            });
        }
        
        function addMarkerToMap(markerData) {
            const marker = L.marker([markerData.lat, markerData.lng]).addTo(markerLayerGroup);
            marker.bindPopup(`
                <b>${markerData.title}</b><br>
                ${markerData.description}<br>
                <i>Category: ${markerData.category}</i><br>
                <small>Added: ${new Date(markerData.createdAt).toLocaleString()}</small>
            `);
            mapMarkers[markerData.id] = marker;
        }
        
        function removeMarkerFromMap(markerId) {
            if (mapMarkers[markerId]) {
                markerLayerGroup.removeLayer(mapMarkers[markerId]);
                delete mapMarkers[markerId];
            }
        }
        
        function toggleMapPanel() {
            document.getElementById('mapPanel').classList.toggle('hidden-panel');
        }
        
        function toggleMapFilter() {
            const filterOptions = document.getElementById('mapFilterOptions');
            const filterBtn = document.querySelector('.map-filter-btn');
            const isHidden = filterOptions.style.display === 'none';
            filterOptions.style.display = isHidden ? 'block' : 'none';
            filterBtn.classList.toggle('active', isHidden);
        }
        
        function selectCategory(elem, cat) {
            document.querySelectorAll('.marker-categories .category-btn').forEach(btn => btn.classList.remove('active'));
            elem.classList.add('active');
            selectedCategory = cat;
        }
        
        function saveCustomCategory() {
            const name = document.getElementById('customCatName').value.trim();
            if(!name) return alert("Nama kategori tidak boleh kosong!");
            const catId = 'custom-' + name.toLowerCase().replace(/\s/g, '-');
            
            if (document.querySelector(`.category-btn[onclick*="${catId}"]`)) {
                 return alert(`Kategori "${name}" sudah ada!`);
            }
            
            const container = document.getElementById('categoryGrid');
            const newBtn = document.createElement('div');
            newBtn.className = 'category-btn';
            newBtn.innerHTML = `<i class="fas fa-star"></i> ${name}`;
            newBtn.onclick = function() { selectCategory(this, catId) };
            container.appendChild(newBtn);
            
            document.getElementById('customCatName').value = '';
            alert(`Kategori "${name}" berhasil disimpan!`);
            selectCategory(newBtn, catId);
        }
        
        function searchMapLocations(query) {
            renderMarkerList(); 
        }
        
        function filterMapMarkers(event, category) {
            currentMapFilter = category;
            document.querySelectorAll('#mapFilterOptions .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            renderMarkerList();
        }
        
        // ==================== QUEST FUNCTIONS ====================
        function filterQuests(event, category) {
            currentQuestFilter = category;
            document.querySelectorAll('.quest-controls .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            renderQuests();
        }
        
        function renderQuests() {
            const container = document.getElementById('questListContainer');
            if (!container) return;
            
            container.innerHTML = '';
            const quests = realtime.getQuests();
            
            let filteredQuests = quests;
            
            if (currentQuestFilter !== 'all') {
                filteredQuests = filteredQuests.filter(q => q.category === currentQuestFilter);
            }
            
            if (currentQuestSearch) {
                filteredQuests = filteredQuests.filter(q => 
                    q.title.toLowerCase().includes(currentQuestSearch) || 
                    q.description.toLowerCase().includes(currentQuestSearch) ||
                    q.user.toLowerCase().includes(currentQuestSearch)
                );
            }
            
            if (filteredQuests.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: var(--text-secondary);">Tidak ada quest yang cocok.</div>';
                return;
            }
            
            filteredQuests.forEach(q => {
                const item = document.createElement('div');
                item.className = 'quest-item';
                const statusClass = q.status === 'open' ? 'status-open' : 'status-taken';
                const statusText = q.status === 'open' ? 'OPEN' : 'TAKEN';
                item.innerHTML = `
                    <span class="quest-status ${statusClass}">${statusText}</span>
                    <h4>${q.title}</h4>
                    <p style="font-size: 0.9rem; color: #aaa;">${q.description.substring(0, 80)}${q.description.length > 80 ? '...' : ''}</p>
                    <div style="margin-top:0.5rem; display: flex; justify-content: space-between; font-size:0.8rem;">
                        <span style="color: var(--primary);"><i class="fas fa-user"></i> ${q.user}</span>
                        <span style="color: var(--text-secondary);"><i class="fas fa-tag"></i> ${q.category.toUpperCase()}</span>
                    </div>`;
                item.onclick = () => openQuestDetail(q);
                container.appendChild(item);
            });
        }
        
        function renderMarkerList() {
            const container = document.getElementById('markerList');
            if (!container) return;
            
            container.innerHTML = '';
            const markers = realtime.getMarkers();
            
            const searchTerm = document.getElementById('mapSearch').value.toLowerCase();
            const filteredMarkers = markers.filter(m => 
                (currentMapFilter === 'all' || m.category === currentMapFilter) &&
                (m.title.toLowerCase().includes(searchTerm) || m.description.toLowerCase().includes(searchTerm))
            );
            
            if (filteredMarkers.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1rem; color: var(--text-secondary);">Tidak ada marker yang cocok.</div>';
                return;
            }
            
            filteredMarkers.forEach((markerData) => {
                const item = document.createElement('div');
                item.className = 'marker-item';
                item.onclick = () => {
                    map.setView([markerData.lat, markerData.lng], 15);
                    if (mapMarkers[markerData.id]) {
                        mapMarkers[markerData.id].openPopup();
                    }
                };
                item.innerHTML = `<h4>${markerData.title}</h4><p>${markerData.description}</p><span class="marker-category">${markerData.category}</span>`;
                container.appendChild(item);
            });
        }
        
        // ==================== MODAL FUNCTIONS ====================
        function openModal(id) { 
            document.getElementById(id).classList.add('active'); 
        }
        
        function closeModal(id) { 
            document.getElementById(id).classList.remove('active'); 
        }
        
        // ==================== QUEST OPERATIONS ====================
        function submitQuest() {
            const user = document.getElementById('qUser').value.trim();
            const title = document.getElementById('qTitle').value.trim();
            const desc = document.getElementById('qDesc').value.trim();
            const contact = document.getElementById('qContact').value.trim();
            const category = document.getElementById('qCategory').value;
            
            if(!user || !title || !contact || !desc) {
                alert("Mohon lengkapi semua data!");
                return;
            }
            
            const questData = {
                user,
                title,
                description: desc,
                contact,
                category,
                status: 'open'
            };
            
            realtime.emit('addQuest', questData);
            closeModal('modalPostQuest');
            
            document.getElementById('qUser').value = '';
            document.getElementById('qTitle').value = '';
            document.getElementById('qDesc').value = '';
            document.getElementById('qContact').value = '';
        }
        
        function addMarker() {
            const title = document.getElementById('markerTitle').value;
            const desc = document.getElementById('markerDesc').value;
            if(!title) {
                alert("Judul marker harus diisi!");
                return;
            }
            if(!currentMarker) {
                alert("Klik peta lokasi dulu!");
                return;
            }
            
            const latlng = currentMarker.getLatLng();
            
            const markerData = {
                title,
                description: desc,
                category: selectedCategory,
                lat: latlng.lat,
                lng: latlng.lng,
                user: 'Anonymous'
            };
            
            realtime.emit('addMarker', markerData);
            
            map.removeLayer(currentMarker);
            currentMarker = null;
            document.getElementById('markerTitle').value = '';
            document.getElementById('markerDesc').value = '';
            document.getElementById('btnAddMarker').disabled = true;
        }
        
        function openQuestDetail(quest) {
            currentQuestId = quest.id;
            document.getElementById('dTitle').innerText = quest.title;
            document.getElementById('dUser').innerText = quest.user;
            document.getElementById('dDesc').innerText = quest.description;
            document.getElementById('dCategory').innerText = quest.category.toUpperCase();
            
            const cleanContact = quest.contact.replace(/\D/g, '');
            document.getElementById('btnWA').onclick = function() { 
                window.open(`https://wa.me/${cleanContact}`, '_blank'); 
            };
            
            const btnTake = document.getElementById('btnTake');
            if(quest.status === 'taken') {
                btnTake.disabled = true; 
                btnTake.innerHTML = "<i class='fas fa-lock'></i> SUDAH DIAMBIL";
            } else {
                btnTake.disabled = false; 
                btnTake.innerHTML = '<i class="fas fa-check-circle"></i> AMBIL ORDER';
            }
            openModal('modalQuestDetail');
        }
        
        function takeOrder() {
            const quests = realtime.getQuests();
            const q = quests.find(x => x.id === currentQuestId);
            if(q && q.status === 'open') {
                realtime.emit('updateQuest', { id: q.id, status: 'taken' });
                closeModal('modalQuestDetail');
                alert(`Order "${q.title}" berhasil diambil! Silakan hubungi ${q.user}.`);
            }
        }
        
        // ==================== ADMIN FUNCTIONS ====================
        function loadAdminDashboard() {
            if (realtime.getIsAdmin()) {
                realtime.emit('getAdminStats');
                loadAdminQuestList();
                loadAdminMarkerList();
                loadAdminCategoryList();
                getVisitorInfo();
            }
        }
        
        function updateAdminStats(stats) {
            const elements = {
                'totalQuests': stats.totalQuests || 0,
                'totalMarkers': stats.totalMarkers || 0,
                'questsOpen': stats.questsOpen || 0,
                'questsTaken': stats.questsTaken || 0,
                'activeUsers': stats.activeUsers || 0,
                'markersToday': stats.markersToday || 0
            };
            
            for (const [id, value] of Object.entries(elements)) {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            }
        }
        
        function loadAdminQuestList() {
            const container = document.getElementById('adminQuestList');
            if (!container) return;
            
            container.innerHTML = '';
            const quests = realtime.getQuests();
            
            quests.forEach(quest => {
                const item = document.createElement('div');
                item.className = 'admin-list-item';
                item.innerHTML = `
                    <div>
                        <strong>${quest.title}</strong>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.3rem;">
                            By: ${quest.user} | Status: <span style="color: ${quest.status === 'open' ? 'var(--success)' : 'var(--warning)'}">${quest.status}</span>
                        </div>
                        <span class="category-badge">${quest.category}</span>
                    </div>
                    <div class="item-actions">
                        <button class="cyber-button btn-small btn-danger" onclick="deleteQuest(${quest.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function loadAdminMarkerList() {
            const container = document.getElementById('adminMarkerList');
            if (!container) return;
            
            container.innerHTML = '';
            const markers = realtime.getMarkers();
            
            markers.forEach(marker => {
                const item = document.createElement('div');
                item.className = 'admin-list-item';
                item.innerHTML = `
                    <div>
                        <strong>${marker.title}</strong>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.3rem;">
                            ${marker.description.substring(0, 50)}${marker.description.length > 50 ? '...' : ''}
                        </div>
                        <span class="category-badge">${marker.category}</span>
                    </div>
                    <div class="item-actions">
                        <button class="cyber-button btn-small btn-danger" onclick="deleteMarker(${marker.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function loadAdminCategoryList() {
            const container = document.getElementById('adminCategoryList');
            if (!container) return;
            
            container.innerHTML = '';
            const categories = realtime.getCategories();
            
            categories.forEach(category => {
                const item = document.createElement('div');
                item.className = 'admin-list-item';
                item.innerHTML = `
                    <div>
                        <strong>${category}</strong>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.3rem;">
                            Custom Category
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="cyber-button btn-small btn-danger" onclick="deleteCategory('${category}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        function deleteQuest(id) {
            if (confirm('Apakah Anda yakin ingin menghapus quest ini?')) {
                realtime.emit('deleteQuest', id);
            }
        }
        
        function deleteMarker(id) {
            if (confirm('Apakah Anda yakin ingin menghapus marker ini?')) {
                realtime.emit('deleteMarker', id);
            }
        }
        
        function deleteCategory(categoryName) {
            if (confirm(`Apakah Anda yakin ingin menghapus kategori "${categoryName}"?`)) {
                realtime.emit('deleteCategory', categoryName);
            }
        }
        
        function addNewCategory() {
            const newCategory = document.getElementById('newCategoryName').value.trim();
            if (!newCategory) {
                alert('Nama kategori tidak boleh kosong!');
                return;
            }
            
            const categories = realtime.getCategories();
            if (categories.includes(newCategory)) {
                alert('Kategori sudah ada!');
                return;
            }
            
            realtime.emit('addCategory', newCategory);
            document.getElementById('newCategoryName').value = '';
        }
        
        function clearAllMarkers() {
            if (confirm('PERINGATAN! Anda yakin ingin menghapus SEMUA markers?')) {
                realtime.emit('clearAllMarkers');
            }
        }
        
        function clearAllQuests() {
            if (confirm('PERINGATAN! Anda yakin ingin menghapus SEMUA quests?')) {
                realtime.emit('clearAllQuests');
            }
        }
        
        function clearAllData() {
            if (confirm('PERINGATAN! Anda yakin ingin menghapus SEMUA data?')) {
                realtime.emit('clearAllMarkers');
                realtime.emit('clearAllQuests');
            }
        }
        
        function getVisitorInfo() {
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('visitorIp').textContent = data.ip;
                })
                .catch(() => {
                    document.getElementById('visitorIp').textContent = 'Unknown';
                });
            
            document.getElementById('visitorBrowser').textContent = navigator.userAgent;
            document.getElementById('visitorPlatform').textContent = navigator.platform;
            document.getElementById('visitorScreen').textContent = `${screen.width}x${screen.height}`;
        }
        
        // ==================== TOOLS FUNCTIONS ====================
        async function checkWhois() {
            const domainInput = document.getElementById('domainInput');
            const resDiv = document.getElementById('whoisResult');
            
            let domainToCheck = domainInput.value.trim().toLowerCase();
            domainToCheck = domainToCheck.replace(/^https?:\/\//, '').split('/')[0];
            
            const parts = domainToCheck.split('.');
            if (parts.length > 2) {
                domainToCheck = parts.slice(-2).join('.'); 
            }
            
            let domain = domainToCheck;

            resDiv.style.display = 'block';
            resDiv.innerHTML = `
                <div style="text-align:center;">
                    <i class="fas fa-satellite-dish fa-spin" style="color:var(--primary); font-size:2rem; margin-bottom:10px;"></i><br>
                    <span style="animation: pulse 1.5s infinite;">MENGIRIM QUERY DNS...</span>
                </div>`;

            if (!domain.includes('.') || domain.length < 4) {
                resDiv.innerHTML = "<span style='color:var(--danger)'>Format domain salah (cth: google.com)</span>";
                return;
            }

            try {
                const dnsUrl = `https://dns.google/resolve?name=${domain}`;
                const response = await fetch(dnsUrl);
                
                if (!response.ok) throw new Error("Gagal menghubungi Google DNS");

                const data = await response.json();

                if (data.Status === 0 && data.Answer && data.Answer.length > 0) {
                    renderDohRegistered(domain, resDiv, data.Answer);
                } else if (data.Status === 3) {
                    renderAvailable(domain, resDiv);
                } else {
                    renderError(domain, resDiv, "Respon DNS tidak valid.");
                }

            } catch (error) {
                console.error("DNS/Network Error:", error);
                renderError(domain, resDiv, `Gagal Melakukan Cek DNS: ${error.message}`);
            }
        }
        
        function renderAvailable(domain, container) {
            container.innerHTML = `
                <div style="text-align:center; padding:1rem; border: 1px dashed var(--success); border-radius:10px;">
                    <i class="fas fa-check-circle" style="font-size:3rem; color:var(--success); margin-bottom:1rem;"></i><br>
                    <span style="color:var(--success); font-weight:bold; font-size:1.2rem;">DOMAIN KOSONG!</span><br>
                    <p style="color:#ccc; font-size:0.9rem; margin:0.5rem 0;">
                        Domain <b>${domain}</b> belum terdaftar. Kamu bisa memilikinya.
                    </p>
                    <a href="https://www.niagahoster.co.id/domain-murah?domain=${domain}" target="_blank" 
                       style="background:var(--success); color:black; padding:5px 15px; border-radius:5px; text-decoration:none; font-weight:bold; font-size:0.8rem; display:inline-block; margin-top:10px;">
                       AMANKAN SEKARANG
                    </a>
                </div>
            `;
        }
        
        function renderDohRegistered(domain, container, answers) {
            const ipAddress = answers.find(a => a.type === 1)?.data || 'Tidak ada IP (Mungkin CNAME)';
            const ttl = answers.length > 0 ? answers[0].TTL : '-';

            let html = `
                <div style="border-left: 3px solid var(--danger); padding-left:10px; margin-bottom:1rem;">
                    <div style="display: flex; align-items: center; margin-bottom: 5px;">
                        <span style="color:var(--danger); font-weight:bold; font-size:1.1rem; margin-right: 8px;">
                            <i class="fas fa-lock"></i> DOMAIN TERDAFTAR
                        </span>
                    </div>
                    <p style="color:#aaa; font-size:0.8rem;">Data ini diambil dari server DNS Google.</p>
                </div>
                
                <table style="width:100%; font-size:0.85rem; border-collapse: separate; border-spacing: 0 5px;">
                    <tr>
                        <td style="color:var(--primary); width:35%;">Domain:</td>
                        <td style="color:white; font-family:monospace;">${domain}</td>
                    </tr>
                    <tr>
                        <td style="color:var(--primary);">Status:</td>
                        <td style="color:var(--danger); font-weight:bold;">AKTIF (DNS DITEMUKAN)</td>
                    </tr>
                    <tr>
                        <td style="color:var(--primary);">IP Address:</td>
                        <td style="color:var(--accent);">${ipAddress}</td>
                    </tr>
                    <tr>
                        <td style="color:var(--primary);">TTL (detik):</td>
                        <td style="color:#aaa;">${ttl}</td>
                    </tr>
                </table>

                <div style="margin-top:20px; padding: 10px; border: 1px dashed rgba(255,255,255,0.2); border-radius: 5px;">
                    <span style="color:var(--text-secondary); font-size:0.9rem; display: block; text-align: center; margin-bottom: 5px;">
                         **Info Lengkap (Registrar/Expired)** memerlukan Cek Manual:
                    </span>
                    <a href="https://who.is/whois/${domain}" target="_blank" class="cyber-button" style="text-decoration:none; display:block; margin-top:5px;">
                        CEK MANUAL (WHO.IS)
                    </a>
                </div>
            `;
            container.innerHTML = html;
        }
        
        function renderError(domain, container, message) {
            container.innerHTML = `
                <div style="color:var(--warning); text-align:center; padding:1rem;">
                    <i class="fas fa-exclamation-triangle"></i><br>
                    <b>${message}</b><br>
                    <span style="font-size:0.8rem">Periksa koneksi internet/format domain.</span>
                    <br><br>
                    <a href="https://who.is/whois/${domain}" target="_blank" class="cyber-button" style="text-decoration:none; display:block;">
                        CEK MANUAL (WHO.IS)
                    </a>
                </div>`;
        }
        
        // ==================== CHAT AI FUNCTIONS ====================
        async function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const chatBody = document.getElementById('chatBody');
            const sendBtn = document.getElementById('chatSendButton');

            const text = chatInput.value.trim();
            if (!text) return alert("Pesan tidak boleh kosong!");

            appendMessage(text, 'user', selectedModel);

            chatInput.value = '';
            sendBtn.disabled = true;
            chatInput.style.height = 'auto';

            try {
                const loadingMessage = appendMessage('<i class="fas fa-spinner fa-spin"></i> Menunggu respons...', 'ai', selectedModel);
                
                let apiUrl;
                const encodedMessage = encodeURIComponent(text);
                
                if (selectedModel === 'dex75') {
                    apiUrl = `https://api.ryzumi.vip/api/ai/deepseek?text=${encodedMessage}`;
                } else if (selectedModel === 'pollination') {
                    apiUrl = `https://api.ryzumi.vip/api/ai/v2/chatgpt?text=${encodedMessage}`;
                }

                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                chatBody.removeChild(loadingMessage); 

                if (response.ok) {
                    const data = await response.json();
                    
                    let resultText = "";
                    
                    if (selectedModel === 'dex75') {
                        resultText = data.data?.result || data.answer || data.data?.answer || "Tidak ada respons dari DeX 75 AI.";
                    } else if (selectedModel === 'pollination') {
                        resultText = data.data?.result || 
                                   data.data?.answer || 
                                   data.answer || 
                                   data.result ||
                                   data.data?.text ||
                                   data.text ||
                                   data.data?.message ||
                                   data.message ||
                                   "Tidak ada respons dari Pollination AI.";
                    }
                    
                    if (!resultText || resultText === "Tidak ada respons dari Pollination AI.") {
                        resultText = "Pollination AI merespons dengan struktur yang tidak dikenali. Silakan coba lagi.";
                    }
                    
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = resultText;
                    resultText = tempDiv.textContent || tempDiv.innerText || resultText;
                    
                    appendMessage(resultText, 'ai', selectedModel);
                    
                } else {
                    const errorText = await response.text();
                    appendMessage(`HTTP Error ${response.status}: Gagal menghubungi server AI`, 'ai', selectedModel);
                }

            } catch (error) {
                const loadingMessages = chatBody.querySelectorAll('.message');
                const lastMessage = loadingMessages[loadingMessages.length - 1];
                if (lastMessage && lastMessage.innerHTML.includes('fa-spinner')) {
                    chatBody.removeChild(lastMessage);
                }
                appendMessage(`Network Error: ${error.message}`, 'ai', selectedModel);
            } finally {
                sendBtn.disabled = false;
                chatBody.scrollTop = chatBody.scrollHeight; 
            }
        }
        
        function appendMessage(text, sender, model) {
            const chatBody = document.getElementById('chatBody');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            let formattedText = text
                .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
                .replace(/\n/g, '<br>');

            messageDiv.innerHTML = formattedText;
            
            if (sender === 'ai') {
                const modelTag = document.createElement('span');
                modelTag.className = 'message-model-tag';
                modelTag.innerText = model.toUpperCase();
                messageDiv.appendChild(modelTag);
            }
            
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
            return messageDiv; 
        }
        
        // ==================== DATA MANAGEMENT ====================
        function exportData() {
            const quests = realtime.getQuests();
            const markers = realtime.getMarkers();
            const categories = realtime.getCategories();
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify({ 
                quests, 
                markers,
                categories,
                exportedAt: new Date().toISOString() 
            }));
            const anchor = document.createElement('a');
            anchor.setAttribute("href", dataStr);
            anchor.setAttribute("download", "simplebisnis_data.json");
            document.body.appendChild(anchor);
            anchor.click();
            anchor.remove();
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = event => {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.quests) {
                            data.quests.forEach(quest => {
                                realtime.emit('addQuest', quest);
                            });
                        }
                        if (data.markers) {
                            data.markers.forEach(marker => {
                                realtime.emit('addMarker', marker);
                            });
                        }
                        alert('Data berhasil diimport!');
                    } catch (error) {
                        alert('Error importing data: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }
        
        function showAnalytics() {
            const quests = realtime.getQuests();
            const markers = realtime.getMarkers();
            
            const openQuests = quests.filter(q => q.status === 'open').length;
            const takenQuests = quests.filter(q => q.status === 'taken').length;
            const uniqueUsers = new Set(quests.map(q => q.user)).size;
            const categories = [...new Set([...markers.map(m => m.category), ...quests.map(q => q.category)])];
            
            alert(`ANALYTICS REPORT:\n
Total Quests: ${quests.length}
Total Markers: ${markers.length}
Quests Open: ${openQuests}
Quests Taken: ${takenQuests}
Unique Users: ${uniqueUsers}
Categories Used: ${categories.join(', ')}`);
        }
        
        function generateReport() {
            const quests = realtime.getQuests();
            const markers = realtime.getMarkers();
            const categories = realtime.getCategories();
            
            const today = new Date().toDateString();
            const markersToday = markers.filter(m => {
                const markerDate = new Date(m.createdAt || Date.now()).toDateString();
                return markerDate === today;
            }).length;
            
            const report = {
                generatedAt: new Date().toISOString(),
                stats: {
                    totalQuests: quests.length,
                    totalMarkers: markers.length,
                    questsOpen: quests.filter(q => q.status === 'open').length,
                    questsTaken: quests.filter(q => q.status === 'taken').length,
                    uniqueUsers: new Set(quests.map(q => q.user)).size,
                    markersToday: markersToday,
                    categoriesUsed: [...new Set([...markers.map(m => m.category), ...quests.map(q => q.category)])]
                },
                recentActivity: {
                    lastQuests: quests.slice(0, 5),
                    lastMarkers: markers.slice(0, 5)
                },
                customCategories: categories
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(report, null, 2));
            const anchor = document.createElement('a');
            anchor.setAttribute("href", dataStr);
            anchor.setAttribute("download", `simplebisnis_report_${new Date().toISOString().split('T')[0]}.json`);
            document.body.appendChild(anchor);
            anchor.click();
            anchor.remove();
        }
        
        function clearCache() {
            if (confirm('Clear cache? Ini akan menghapus data sementara.')) {
                localStorage.clear();
                sessionStorage.clear();
                alert('Cache cleared successfully!');
            }
        }
        
        function rebuildIndex() {
            alert('Index rebuilt successfully!');
        }
        
        // ==================== INITIALIZATION ====================
        window.onload = function() {
            simulateLoading();
            initMap();
            checkAdminAccess();
            
            // Event Listeners
            const questSearch = document.getElementById('questSearch');
            if (questSearch) {
                questSearch.addEventListener('input', function() {
                    currentQuestSearch = this.value.toLowerCase();
                    renderQuests();
                });
            }
            
            const mapSearch = document.getElementById('mapSearch');
            if (mapSearch) {
                mapSearch.addEventListener('input', function() {
                    searchMapLocations(this.value);
                });
            }
            
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault(); 
                        sendMessage();
                    }
                });
                
                chatInput.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = (this.scrollHeight) + 'px';
                });
            }
        };

    </script>
</body>
</html>

